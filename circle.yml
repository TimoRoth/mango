version: 2

jobs:
  build:
    docker:
      - image: buildpack-deps:stretch-scm
    steps:
      - run:
          name: Install prerequisites
          command: |
            wget -qO - https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -
            echo "deb http://apt.llvm.org/stretch/ llvm-toolchain-stretch-5.0 main" > /etc/apt/sources.list.d/clang-5.0.list
            apt-get -qq update
            apt-get -qq install --yes --no-install-recommends clang-5.0 gcc-6 gcc-6-multilib make
      - checkout
      - run:
          name: Build (x64)
          command: |
            mkdir -p bin/x64/Release/0xf000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG" PREFIX=bin/x64/Release/0xf000/clang-5.0/
            mkdir -p bin/x64/Release/0xf000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG" PREFIX=bin/x64/Release/0xf000/gcc-6/
            mkdir -p bin/x64/Release/0xe000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64" PREFIX=bin/x64/Release/0xe000/clang-5.0/
            mkdir -p bin/x64/Release/0xe000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64" PREFIX=bin/x64/Release/0xe000/gcc-6/
            mkdir -p bin/x64/Release/0xd000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32" PREFIX=bin/x64/Release/0xd000/clang-5.0/
            mkdir -p bin/x64/Release/0xd000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_F32" PREFIX=bin/x64/Release/0xd000/gcc-6/
            mkdir -p bin/x64/Release/0xc000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32" PREFIX=bin/x64/Release/0xc000/clang-5.0/
            mkdir -p bin/x64/Release/0xc000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32" PREFIX=bin/x64/Release/0xc000/gcc-6/
            mkdir -p bin/x64/Release/0xb000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F64" PREFIX=bin/x64/Release/0xb000/clang-5.0/
            mkdir -p bin/x64/Release/0xb000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_F64" PREFIX=bin/x64/Release/0xb000/gcc-6/
            mkdir -p bin/x64/Release/0xa000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64" PREFIX=bin/x64/Release/0xa000/clang-5.0/
            mkdir -p bin/x64/Release/0xa000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64" PREFIX=bin/x64/Release/0xa000/gcc-6/
            mkdir -p bin/x64/Release/0x9000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x64/Release/0x9000/clang-5.0/
            mkdir -p bin/x64/Release/0x9000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x64/Release/0x9000/gcc-6/
            mkdir -p bin/x64/Release/0x8000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x64/Release/0x8000/clang-5.0/
            mkdir -p bin/x64/Release/0x8000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x64/Release/0x8000/gcc-6/
            mkdir -p bin/x64/Release/0x7000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x7000/clang-5.0/
            mkdir -p bin/x64/Release/0x7000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x7000/gcc-6/
            mkdir -p bin/x64/Release/0x6000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x6000/clang-5.0/
            mkdir -p bin/x64/Release/0x6000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x6000/gcc-6/
            mkdir -p bin/x64/Release/0x5000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x5000/clang-5.0/
            mkdir -p bin/x64/Release/0x5000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x5000/gcc-6/
            mkdir -p bin/x64/Release/0x4000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x4000/clang-5.0/
            mkdir -p bin/x64/Release/0x4000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x4000/gcc-6/
            mkdir -p bin/x64/Release/0x3000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x3000/clang-5.0/
            mkdir -p bin/x64/Release/0x3000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x3000/gcc-6/
            mkdir -p bin/x64/Release/0x2000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x2000/clang-5.0/
            mkdir -p bin/x64/Release/0x2000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x2000/gcc-6/
            mkdir -p bin/x64/Release/0x1000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x1000/clang-5.0/
            mkdir -p bin/x64/Release/0x1000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x1000/gcc-6/
            mkdir -p bin/x64/Release/0x0000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target x86_64-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x0000/clang-5.0/
            mkdir -p bin/x64/Release/0x0000/gcc-6/ && make CC=gcc-6 CFLAGS="-m64 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x64/Release/0x0000/gcc-6/
      - run:
          name: Build (x86)
          command: |
            mkdir -p bin/x86/Release/0xf000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG" PREFIX=bin/x86/Release/0xf000/clang-5.0/
            mkdir -p bin/x86/Release/0xf000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG" PREFIX=bin/x86/Release/0xf000/gcc-6/
            mkdir -p bin/x86/Release/0xe000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64" PREFIX=bin/x86/Release/0xe000/clang-5.0/
            mkdir -p bin/x86/Release/0xe000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64" PREFIX=bin/x86/Release/0xe000/gcc-6/
            mkdir -p bin/x86/Release/0xd000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32" PREFIX=bin/x86/Release/0xd000/clang-5.0/
            mkdir -p bin/x86/Release/0xd000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_F32" PREFIX=bin/x86/Release/0xd000/gcc-6/
            mkdir -p bin/x86/Release/0xc000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32" PREFIX=bin/x86/Release/0xc000/clang-5.0/
            mkdir -p bin/x86/Release/0xc000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32" PREFIX=bin/x86/Release/0xc000/gcc-6/
            mkdir -p bin/x86/Release/0xb000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F64" PREFIX=bin/x86/Release/0xb000/clang-5.0/
            mkdir -p bin/x86/Release/0xb000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_F64" PREFIX=bin/x86/Release/0xb000/gcc-6/
            mkdir -p bin/x86/Release/0xa000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64" PREFIX=bin/x86/Release/0xa000/clang-5.0/
            mkdir -p bin/x86/Release/0xa000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64" PREFIX=bin/x86/Release/0xa000/gcc-6/
            mkdir -p bin/x86/Release/0x9000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x86/Release/0x9000/clang-5.0/
            mkdir -p bin/x86/Release/0x9000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x86/Release/0x9000/gcc-6/
            mkdir -p bin/x86/Release/0x8000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x86/Release/0x8000/clang-5.0/
            mkdir -p bin/x86/Release/0x8000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64" PREFIX=bin/x86/Release/0x8000/gcc-6/
            mkdir -p bin/x86/Release/0x7000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x7000/clang-5.0/
            mkdir -p bin/x86/Release/0x7000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x7000/gcc-6/
            mkdir -p bin/x86/Release/0x6000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x6000/clang-5.0/
            mkdir -p bin/x86/Release/0x6000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x6000/gcc-6/
            mkdir -p bin/x86/Release/0x5000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x5000/clang-5.0/
            mkdir -p bin/x86/Release/0x5000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x5000/gcc-6/
            mkdir -p bin/x86/Release/0x4000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x4000/clang-5.0/
            mkdir -p bin/x86/Release/0x4000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x4000/gcc-6/
            mkdir -p bin/x86/Release/0x3000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x3000/clang-5.0/
            mkdir -p bin/x86/Release/0x3000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x3000/gcc-6/
            mkdir -p bin/x86/Release/0x2000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x2000/clang-5.0/
            mkdir -p bin/x86/Release/0x2000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x2000/gcc-6/
            mkdir -p bin/x86/Release/0x1000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x1000/clang-5.0/
            mkdir -p bin/x86/Release/0x1000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x1000/gcc-6/
            mkdir -p bin/x86/Release/0x0000/clang-5.0/ && make CC=clang-5.0 CFLAGS="-target i686-pc-linux-gnu -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x0000/clang-5.0/
            mkdir -p bin/x86/Release/0x0000/gcc-6/ && make CC=gcc-6 CFLAGS="-m32 -O3 -DNDEBUG -DMANGO_NO_I64 -DMANGO_NO_F32 -DMANGO_NO_F64 -DMANGO_NO_REFS" PREFIX=bin/x86/Release/0x0000/gcc-6/
      - store_artifacts:
          path: bin/x64/Release/0xf000/clang-5.0/
          destination: /
